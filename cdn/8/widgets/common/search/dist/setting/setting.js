System.register(["jimu-core","jimu-ui","jimu-for-builder","jimu-ui/advanced/setting-components","jimu-ui/advanced/data-source-selector","jimu-ui/advanced/resource-selector","jimu-ui/basic/list-tree","jimu-core/react"],(function(e,t){var o={},n={},a={},l={},i={},s={},r={},c={};return{setters:[function(e){o.DataSourceComponent=e.DataSourceComponent,o.DataSourceManager=e.DataSourceManager,o.DataSourceTypes=e.DataSourceTypes,o.Immutable=e.Immutable,o.JimuFieldType=e.JimuFieldType,o.LinkType=e.LinkType,o.React=e.React,o.ReactRedux=e.ReactRedux,o.classNames=e.classNames,o.css=e.css,o.defaultMessages=e.defaultMessages,o.esri=e.esri,o.jsx=e.jsx,o.lodash=e.lodash,o.polished=e.polished},function(e){n.Alert=e.Alert,n.Button=e.Button,n.Checkbox=e.Checkbox,n.Dropdown=e.Dropdown,n.DropdownButton=e.DropdownButton,n.DropdownItem=e.DropdownItem,n.DropdownMenu=e.DropdownMenu,n.Icon=e.Icon,n.PanelHeader=e.PanelHeader,n.Switch=e.Switch,n.TextArea=e.TextArea,n.TextInput=e.TextInput,n.defaultMessages=e.defaultMessages,n.hooks=e.hooks},function(e){a.getAppConfigAction=e.getAppConfigAction},function(e){l.LinkSettingPopup=e.LinkSettingPopup,l.OpenTypes=e.OpenTypes,l.SettingCollapse=e.SettingCollapse,l.SettingRow=e.SettingRow,l.SettingSection=e.SettingSection,l.SidePopper=e.SidePopper},function(e){i.AllDataSourceTypes=e.AllDataSourceTypes,i.DataSourceSelector=e.DataSourceSelector,i.FieldSelector=e.FieldSelector,i.dataComponentsUtils=e.dataComponentsUtils},function(e){s.IconPicker=e.IconPicker},function(e){r.List=e.List,r.TreeItemActionType=e.TreeItemActionType},function(e){c.useEffect=e.useEffect}],execute:function(){e((()=>{var e={24786:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M2.343 8l1.768-1.768.707.707L3.05 8.707a3 3 0 004.243 4.243l1.767-1.768.708.707L8 13.657A4 4 0 112.343 8zM12.95 7.293l-1.768 1.768.707.707L13.657 8A4 4 0 108 2.343L6.232 4.111l.707.707L8.707 3.05a3 3 0 014.243 4.243z" fill="#000"></path><path d="M5.879 9.414a.5.5 0 00.707.707l3.535-3.535a.5.5 0 00-.707-.707L5.879 9.414z" fill="#000"></path></svg>'},34750:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M7.5 0a.5.5 0 00-.5.5V7H.5a.5.5 0 000 1H7v6.5a.5.5 0 001 0V8h6.5a.5.5 0 000-1H8V.5a.5.5 0 00-.5-.5z" fill="#000"></path></svg>'},79964:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M8 2.125L14.334 14H1.667L8 2.125zm-.882-.47a1 1 0 011.765 0l6.333 11.874A1 1 0 0114.334 15H1.667a1 1 0 01-.882-1.47L7.118 1.653zM8 4.874a.905.905 0 00-.9.995l.35 3.507a.552.552 0 001.1 0L8.9 5.87a.905.905 0 00-.9-.995zm1 7a1 1 0 11-2 0 1 1 0 012 0z" fill="#000"></path></svg>'},40325:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M19.637 15.866L30.951 27.18a2.667 2.667 0 01-3.771 3.771L15.866 19.637 4.552 30.951A2.667 2.667 0 01.781 27.18l11.314-11.314L.781 4.552A2.667 2.667 0 014.552.781l11.314 11.314L27.18.781a2.667 2.667 0 013.771 3.771L19.637 15.866z"></path></svg>'},1810:e=>{"use strict";e.exports=o},52127:e=>{"use strict";e.exports=c},3297:e=>{"use strict";e.exports=a},21835:e=>{"use strict";e.exports=n},33037:e=>{"use strict";e.exports=i},50831:e=>{"use strict";e.exports=s},23080:e=>{"use strict";e.exports=l},82165:e=>{"use strict";e.exports=r}},t={};function u(o){var n=t[o];if(void 0!==n)return n.exports;var a=t[o]={exports:{}};return e[o](a,a.exports,u),a.exports}u.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return u.d(t,{a:t}),t},u.d=(e,t)=>{for(var o in t)u.o(t,o)&&!u.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},u.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),u.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},u.p="";var d={};return u.p=window.jimuConfig.baseUrl,(()=>{"use strict";u.r(d),u.d(d,{default:()=>oe});var e,t,o,n,a=u(1810),l=u(21835),i=u(3297),s=u(23080);!function(e){e.GeocodeService="GeocodeService",e.FeatureService="FeatureService"}(e||(e={})),function(e){e.ResultPanel="Result_Panel",e.OtherWidgets="Other_Widgets"}(t||(t={})),function(e){e.Style1="Style1",e.Style2="Style2"}(o||(o={})),function(e){e.None="",e.Init="init",e.Loading="loading",e.Loaded="loaded",e.Warning="warning",e.Error="error"}(n||(n={}));var r=u(34750),c=u.n(r);const p=e=>{const{className:t}=e,o=function(e,t){var o={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(o[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(n=Object.getOwnPropertySymbols(e);a<n.length;a++)t.indexOf(n[a])<0&&Object.prototype.propertyIsEnumerable.call(e,n[a])&&(o[n[a]]=e[n[a]])}return o}(e,["className"]),n=(0,a.classNames)("jimu-icon-component",t);return a.React.createElement(l.Icon,Object.assign({className:n,icon:c()},o))},m={addSources:"Add new search sources and customize options",newSearchSource:"New search source",layerSource:"Layer source",locatorSource:"Locator source",geocodingService:"ArcGis World Geocoding Service",generalSearchOption:"General search options",multySearchHint:"Hint for multiple search sources",findAddressOrPlace:"Find address or place",searchSuggestion:"Search suggestion",searchResult:"Search result",arrangementStyle:"Arrangement style",maximumSuggestions:"Maximum suggestions per source",useCurrentLocation:"Use current location",recentSearches:"Recent searches",showSearchResult:"Show search results in",resultPanel:"Result panel",otherWidgets:"Other widgets",autoSelect:"Auto select the first result",redirectSearchResult:"Redirect if search result is not empty",notSetCorrectle:"The search or display field is not set correctly.",searchOption:"Search options",selectSearchFields:"Select searching fields",selectedField:"{fieldNumber} Selected",searchHint:"Hint",searchOptions:"Search options",exactMatch:"Exact match",displayFields:"Display fields",searchIcon:"Icon",setLayerSource:"Set layer source",setLocatorSource:"Set locator source",locatorUrl:"Locator URL",searchExample:"Example: {url}",enterUrl:"Enter URL(HTTPS only)",onluSupportedHTTPS:"Only HTTPS is supported",locatorSourceErrorHint:"The URL you entered is invalid or inaccessible",locatorUrlError:"Locator URL is not set correctly",invalidUrl:"An invalid URL",maximumNumber:"Maximum number",maximumResults:"Maximum display results per source",outputDsLabel:"{label} result",exampleUrl:"Example: {url}",searchBoxTip:"Search box",searchIconTip:"Search icon"};var v=u(33037),g=u(50831);const S="objectid",h="address",f="https://geocode.arcgis.com/arcgis/rest/services/World/GeocodeServer",x="ArcGIS World Geocoding Service",y=e=>b(e)?x:w(e),w=e=>{if(!e)return"geocoder";const t=e.split("/");return t[t.length-2]||"geocoder"},b=e=>!!e&&/(?:arcgis\.com\/arcgis\/rest\/services\/world\/geocodeserver).*/gi.test(e),I={jimuName:S,alias:"OBJECTID",type:a.JimuFieldType.Number,name:S},j={jimuName:h,alias:"ADDRESS",type:a.JimuFieldType.String,name:h},C=(e="")=>({label:e,idField:S,fields:{[S]:I,[h]:j}}),T=(e,t)=>{var o;return(null===(o=t.filter((t=>(null==t?void 0:t.dataSourceId)===(null==e?void 0:e.dataSourceId))))||void 0===o?void 0:o.length)>0},D=e=>null==e?void 0:e.map((e=>e.configId)),R=e=>e&&0!==(null==e?void 0:e.length)?`config_${O(e)+1}`:"config_0",O=e=>{var t;const o=null==e?void 0:e.map((e=>{var t;const o=null===(t=null==e?void 0:e.split("_"))||void 0===t?void 0:t.pop();return o?Number(o):0}));return null===(t=null==o?void 0:o.sort(((e,t)=>t-e)))||void 0===t?void 0:t[0]},N=(e,t)=>{var o;if(!e)return`${t}_output_0`;const n=null===(o=null==e?void 0:e.split("_"))||void 0===o?void 0:o.pop();return`${t}_output_${Number(n)}`};var L=u(82165);const A=e=>{const t={overrideItemBlockInfo:({itemBlockInfo:e},t)=>({name:L.TreeItemActionType.RenderOverrideItem,children:[{name:L.TreeItemActionType.RenderOverrideItemDroppableContainer,children:[{name:L.TreeItemActionType.RenderOverrideItemDraggableContainer,children:[{name:L.TreeItemActionType.RenderOverrideItemBody,children:[{name:L.TreeItemActionType.RenderOverrideItemMainLine,children:[{name:L.TreeItemActionType.RenderOverrideItemDragHandle},{name:L.TreeItemActionType.RenderOverrideItemIcon,autoCollapsed:!0},{name:L.TreeItemActionType.RenderOverrideItemTitle},{name:L.TreeItemActionType.RenderOverrideItemCommands}]}]}]}]}]})},o=a.css`
    &{
      max-height: 256px;
      overflow-y: auto;
    }
  `,n=a.ReactRedux.useSelector((e=>null==e?void 0:e.theme)),{disPlayField:l,useDataSource:i,onFieldChange:s}=e;return(0,a.jsx)("div",{className:"w-100"},(0,a.jsx)(v.FieldSelector,{useDataSources:i?(0,a.Immutable)([i]):(0,a.Immutable)([]),onChange:e=>{s(e,l,!0)},selectedFields:(0,a.Immutable)(null==l?void 0:l.map((e=>null==e?void 0:e.name))),isMultiple:!0,isSearchInputHidden:!1,isDataSourceDropDownHidden:!0,useDropdown:!0,useMultiDropdownBottomTools:!0,types:(0,a.Immutable)([a.JimuFieldType.Number,a.JimuFieldType.String])}),(0,a.jsx)("div",{css:o},(0,a.jsx)(L.List,Object.assign({size:"sm",className:"mt-2",itemsJson:Array.from(l).map(((e,t)=>({itemStateDetailContent:e,itemKey:`${null==e?void 0:e.name}${t}`,itemStateIcon:v.dataComponentsUtils.getIconFromFieldType(e.type,n),itemStateTitle:e.alias||e.jimuName||e.name,itemStateCommands:[]}))),dndEnabled:!0,onUpdateItem:(e,t)=>{const{itemJsons:o}=t.props,[,n]=o,a=n.map((e=>e.itemStateDetailContent));s(a,l,!0)},isItemFocused:()=>!1},t))))},{useEffect:k}=a.React,P=(0,a.Immutable)([v.AllDataSourceTypes.FeatureLayer,v.AllDataSourceTypes.SceneLayer]),M=t=>{var o,n;const i=l.hooks.useTranslate(m,l.defaultMessages,a.defaultMessages),{trigger:r,isOpen:c,id:u,config:d,dsConfigItemIndex:p,toggle:S,updateConfigForLayerOptions:h,onSettingChange:f}=t,x=(null===(o=null==d?void 0:d.datasourceConfig)||void 0===o?void 0:o[p])||(0,a.Immutable)({}),{configId:y,label:w,icon:b,searchFields:I,searchExact:j,displayFields:C,hint:T,useDataSource:O}=x,[N,L]=a.React.useState(null),[M,F]=a.React.useState(w);k((()=>{y&&F(w)}),[y]);const z=(t,o)=>{var n;const a=D(null===(n=null==d?void 0:d.datasourceConfig)||void 0===n?void 0:n.asMutable({deep:!0})),l=y||R(a);let s=(null==d?void 0:d.datasourceConfig)?d.datasourceConfig.asMutable({deep:!0}):[];const r=null==t?void 0:t.getLabel(),c=E(o),u={configId:l,icon:null,label:r,displayLabel:!0,useDataSource:o,displayFields:c,searchFields:c,hint:i("findAddressOrPlace"),searchServiceType:e.FeatureService};return(null==x?void 0:x.configId)?s=s.map((e=>(null==e?void 0:e.configId)===l?u:e)):s.push(u),{dsConfigItem:u,datasourceConfig:s}},E=e=>{var t,o,n,l;const i=a.DataSourceManager.getInstance().getDataSource(null==e?void 0:e.dataSourceId),s=null===(t=i.getLayerDefinition())||void 0===t?void 0:t.displayField,r=null===(o=null==i?void 0:i.getSchema())||void 0===o?void 0:o.fields;let c;const u=[];for(const e in r)(null===(n=null==r?void 0:r[e])||void 0===n?void 0:n.type)!==a.JimuFieldType.Date&&u.push(null==r?void 0:r[e]),(null===(l=null==r?void 0:r[e])||void 0===l?void 0:l.name)===s&&(c=null==r?void 0:r[e]);const d=(null==u?void 0:u.length)>1?u[1]:u[0];return c?[(0,a.Immutable)(c)]:[(0,a.Immutable)(d)]},H=(e,t,o=!1)=>{var n,l,i;if(!e)return;const s=o?"displayFields":"searchFields";let r=U(e);0===(null==r?void 0:r.length)&&(r=null===(l=null===(n=(0,a.Immutable)(t))||void 0===n?void 0:n.asMutable({deep:!0}))||void 0===l?void 0:l.splice(0,1));const c=null===(i=null==d?void 0:d.datasourceConfig)||void 0===i?void 0:i.asMutable({deep:!0}),m=null==x?void 0:x.setIn([s],r);null==c||c.splice(p,1,null==m?void 0:m.asMutable({deep:!0}));const v=d.setIn(["datasourceConfig"],c);f({id:u,config:v})},U=e=>null==e?void 0:e.filter((e=>(null==e?void 0:e.type)!==(null===a.JimuFieldType||void 0===a.JimuFieldType?void 0:a.JimuFieldType.Date))),B=(e,t)=>{var o;const n=null===(o=null==d?void 0:d.datasourceConfig)||void 0===o?void 0:o.asMutable({deep:!0}),a=null==x?void 0:x.setIn(e,t);null==n||n.splice(p,1,null==a?void 0:a.asMutable({deep:!0}));const l=d.setIn(["datasourceConfig"],n);f({id:u,config:l})},J=(null==x?void 0:x.useDataSource)?[null===(n=null==x?void 0:x.useDataSource)||void 0===n?void 0:n.asMutable({deep:!0})]:[];return(0,a.jsx)(s.SidePopper,{isOpen:c,position:"right",toggle:S,trigger:r},(0,a.jsx)(l.PanelHeader,{className:"pt-3 px-3",title:i("setLayerSource"),onClose:S}),(0,a.jsx)("div",{className:"w-100",css:a.css`height: calc(100% - 40px);overflow: auto;`},(0,a.jsx)(s.SettingSection,null,(0,a.jsx)(s.SettingRow,{flow:"wrap",label:i("data")},(0,a.jsx)(v.DataSourceSelector,{closeDataSourceListOnChange:!0,types:P,useDataSources:(0,a.Immutable)(J),disableRemove:()=>!0,mustUseDataSource:!0,onChange:e=>{e&&e.length>0&&(e=>{a.DataSourceManager.getInstance().createDataSourceByUseDataSource((0,a.Immutable)(e)).then((e=>{const t=(o=e)?o.type===a.DataSourceTypes.SceneLayer?o.getAssociatedDataSource():o:null;var o;return t||Promise.reject(Error("")),t})).then((t=>{const{datasourceConfig:o}=z(t,e),n=d.setIn(["datasourceConfig"],o);h(n)}))})(e[0])},widgetId:u}))),(null==x?void 0:x.configId)&&N&&(0,a.jsx)("div",null,(0,a.jsx)(s.SettingSection,null,(0,a.jsx)(s.SettingRow,{flow:"wrap",label:i("label")},(0,a.jsx)(l.TextInput,{size:"sm",value:M||"",onAcceptValue:e=>{e?(F(null==e?void 0:e.trim()),B(["label"],null==e?void 0:e.trim())):F(w)},onChange:e=>{var t;const o=null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value;F(o)},className:"w-100",placeholder:i("findAddressOrPlace")}))),(0,a.jsx)(s.SettingSection,null,(0,a.jsx)(s.SettingRow,{label:i("searchIcon")},(0,a.jsx)(g.IconPicker,{buttonOptions:{type:"default",size:"sm"},icon:b,onChange:e=>{B(["icon"],e)},configurableOption:"none"}))),(0,a.jsx)(s.SettingSection,{title:i("searchOptions")},(0,a.jsx)(s.SettingRow,{flow:"wrap",label:i("selectSearchFields")},(0,a.jsx)(v.FieldSelector,{useDataSources:O?(0,a.Immutable)([O]):(0,a.Immutable)([]),onChange:e=>{H(e,I)},selectedFields:(0,a.Immutable)(null==I?void 0:I.map((e=>null==e?void 0:e.name))),isMultiple:!0,isSearchInputHidden:!1,isDataSourceDropDownHidden:!0,useDropdown:!0,useMultiDropdownBottomTools:!0,types:(0,a.Immutable)([a.JimuFieldType.Number,a.JimuFieldType.String])}),(0,a.jsx)("div",{className:"mt-2"},(0,a.jsx)(l.Checkbox,{checked:j,onClick:e=>{const t=e.currentTarget;t&&B(["searchExact"],t.checked)},className:"mr-1"})," ",i("exactMatch"))),(0,a.jsx)(s.SettingRow,{flow:"wrap",label:i("displayFields")},(0,a.jsx)(A,{disPlayField:C||[],onFieldChange:H,useDataSource:O})),(0,a.jsx)(s.SettingRow,{flow:"wrap",label:i("searchHint")},(0,a.jsx)(l.TextInput,{size:"sm",value:T||"",onChange:e=>{var t;const o=null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value;B(["hint"],o)},className:"w-100",placeholder:i("findAddressOrPlace")})))),(null==J?void 0:J[0])&&(0,a.jsx)("div",{className:"waiting-for-database"},(0,a.jsx)(a.DataSourceComponent,{useDataSource:(0,a.Immutable)(J[0]),onDataSourceCreated:e=>{L(e)}}))))};var F=u(79964),z=u.n(F);const E=e=>{const{className:t}=e,o=function(e,t){var o={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(o[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(n=Object.getOwnPropertySymbols(e);a<n.length;a++)t.indexOf(n[a])<0&&Object.prototype.propertyIsEnumerable.call(e,n[a])&&(o[n[a]]=e[n[a]])}return o}(e,["className"]),n=(0,a.classNames)("jimu-icon-component",t);return a.React.createElement(l.Icon,Object.assign({className:n,icon:z()},o))};const{useEffect:H,useRef:U}=a.React,{useSelector:B}=a.ReactRedux,J=new(0,a.esri.Sanitizer),_=t=>{var o,n,i,r,c,u,d;const p=l.hooks.useTranslate(m,l.defaultMessages,a.defaultMessages),v=U((e=>{})),S=B((e=>null==e?void 0:e.theme)),{id:h,trigger:w,toggle:b,isOpen:I,config:j,dsConfigItemIndex:C,onSettingChange:T,updateConfigForLayerOptions:O}=t,N=(null===(o=null==j?void 0:j.datasourceConfig)||void 0===o?void 0:o[C])||(0,a.Immutable)({}),{configId:L,label:A,icon:k,geocodeURL:P,hint:M}=N,[F,z]=a.React.useState(null),[_,$]=a.React.useState(P),[G,W]=a.React.useState(!1),[V,q]=a.React.useState(A);H((()=>{I&&((null==N?void 0:N.geocodeURL)?(W(!0),z(!0),$(P),q(null==N?void 0:N.label)):(W(!1),$(""),q(x),!1!==F&&z(!1)))}),[C,L,I]),H((()=>{v.current=a.lodash.debounce((e=>{K(e).then((e=>{!G&&W(!0),z(!!e)})).catch((e=>{z(!1)}))}),500)}),[]);const K=e=>{return t=void 0,o=void 0,a=function*(){if(!e||!/^(http:\/\/www\.|https:\/\/www\.|http:\/\/|https:\/\/)?[a-z0-9]+([\-\.]{1}[a-z0-9]+)*\.[a-z]{2,5}(:[0-9]{1,5})?(\/.*)?$/.test(e))return!1;try{return yield fetch(`${e}?f=json`).then((e=>e.json())).then((e=>!e.error))}catch(e){return!1}},new((n=void 0)||(n=Promise))((function(e,l){function i(e){try{r(a.next(e))}catch(e){l(e)}}function s(e){try{r(a.throw(e))}catch(e){l(e)}}function r(t){var o;t.done?e(t.value):(o=t.value,o instanceof n?o:new n((function(e){e(o)}))).then(i,s)}r((a=a.apply(t,o||[])).next())}));var t,o,n,a},Q=(e,t)=>{var o;const n=null===(o=null==j?void 0:j.datasourceConfig)||void 0===o?void 0:o.asMutable({deep:!0}),a=null==N?void 0:N.setIn(e,t);null==n||n.splice(C,1,null==a?void 0:a.asMutable({deep:!0}));const l=j.setIn(["datasourceConfig"],n);T({id:h,config:l})},X=J.sanitize(p("exampleUrl",{url:`${f}`}));return(0,a.jsx)(s.SidePopper,{isOpen:I,position:"right",toggle:b,trigger:w},(0,a.jsx)(l.PanelHeader,{className:"pt-3 px-3",title:p("setLocatorSource"),onClose:b}),(0,a.jsx)("div",{className:"w-100",css:a.css`height: calc(100% - 40px);overflow: auto;`},(0,a.jsx)(s.SettingSection,null,(0,a.jsx)(s.SettingRow,{flow:"wrap",label:p("locatorUrl")},(0,a.jsx)(l.TextArea,{placeholder:p("enterUrl"),value:_||"",style:{minHeight:a.polished.rem(100)},onChange:e=>{const t=e.target.value;$(t),v.current(t)},onBlur:t=>{var o;const n=t.target.value;null===(o=v.current)||void 0===o||o.cancel(),K(n).then((t=>{t?(t=>{var o;const n=D(null===(o=null==j?void 0:j.datasourceConfig)||void 0===o?void 0:o.asMutable({deep:!0})),a=L||R(n);let l=(null==j?void 0:j.datasourceConfig)?j.datasourceConfig.asMutable({deep:!0}):[];const i=y(t),s={configId:a,icon:null,label:i,hint:p("findAddressOrPlace"),outputDataSourceId:`${h}_output_${a}`,geocodeURL:t,searchServiceType:e.GeocodeService};(null==N?void 0:N.configId)?l=l.map((e=>(null==e?void 0:e.configId)===a?s:e)):l.push(s);const r=j.setIn(["datasourceConfig"],l);O(r)})(n):P&&(z(!0),$(P))})).catch((e=>{z(!0),$(P)}))}}),(0,a.jsx)("div",{className:"mt-2 text-break"},(0,a.jsx)("i",{style:{fontSize:a.polished.rem(12),color:null===(i=null===(n=S.colors)||void 0===n?void 0:n.palette)||void 0===i?void 0:i.dark[500]},dangerouslySetInnerHTML:{__html:X}})),!1===F&&G&&(0,a.jsx)("div",{className:"d-flex w-100 align-items-center justify-content-between mt-1"},(0,a.jsx)(E,{size:16,color:null===(c=null===(r=S.colors)||void 0===r?void 0:r.palette)||void 0===c?void 0:c.danger[500]}),(0,a.jsx)("div",{style:{width:"calc(100% - 20px)",margin:"0 4px",overflow:"hidden",textOverflow:"ellipsis",color:null===(d=null===(u=S.colors)||void 0===u?void 0:u.palette)||void 0===d?void 0:d.danger[500]}},p("onluSupportedHTTPS"))))),F&&L&&(0,a.jsx)("div",null,(0,a.jsx)(s.SettingSection,null,(0,a.jsx)(s.SettingRow,{flow:"wrap",label:p("label")},(0,a.jsx)(l.TextInput,{size:"sm",value:V||"",onChange:e=>{var t;const o=null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value;q(o)},onAcceptValue:e=>{e?(q(null==e?void 0:e.trim()),Q(["label"],null==e?void 0:e.trim())):q(A)},className:"w-100",placeholder:p("findAddressOrPlace")}))),(0,a.jsx)(s.SettingSection,null,(0,a.jsx)(s.SettingRow,{label:p("searchIcon")},(0,a.jsx)(g.IconPicker,{buttonOptions:{type:"default",size:"sm"},icon:k,onChange:e=>{Q(["icon"],e)},configurableOption:"none"}))),(0,a.jsx)(s.SettingSection,{title:p("searchOptions")},(0,a.jsx)(s.SettingRow,{flow:"wrap",label:p("searchHint")},(0,a.jsx)(l.TextInput,{size:"sm",value:M||"",onChange:e=>{var t;const o=null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value;Q(["hint"],o)},className:"w-100",placeholder:p("findAddressOrPlace")}))))))},$=u(40325),G=t=>{const o=l.hooks.useTranslate(a.defaultMessages),{className:n,datasourceConfig:i,useDataSources:s,config:r,dsConfigItemIndex:c,showSourcePanel:u,showNewSourceItem:d,id:p,onDsConfigIdChange:m,updateConfigForLayerOptions:v,hideSidePopper:g}=t,S=a.ReactRedux.useSelector((e=>{var t,o,n;return null===(n=null===(o=null===(t=null==e?void 0:e.appStateInBuilder)||void 0===t?void 0:t.appConfig)||void 0===o?void 0:o.widgets)||void 0===n?void 0:n[p]})),h={isItemFocused:(e,t)=>{const{itemJsons:[o,n]}=t.props;return u&&n.indexOf(o)===c},overrideItemBlockInfo:({itemBlockInfo:e},t)=>({name:L.TreeItemActionType.RenderOverrideItem,children:[{name:L.TreeItemActionType.RenderOverrideItemDroppableContainer,children:[{name:L.TreeItemActionType.RenderOverrideItemDraggableContainer,children:[{name:L.TreeItemActionType.RenderOverrideItemBody,children:[{name:L.TreeItemActionType.RenderOverrideItemMainLine,children:[{name:L.TreeItemActionType.RenderOverrideItemDragHandle},{name:L.TreeItemActionType.RenderOverrideItemIcon,autoCollapsed:!0},{name:L.TreeItemActionType.RenderOverrideItemTitle},{name:L.TreeItemActionType.RenderOverrideItemDetailToggle},{name:L.TreeItemActionType.RenderOverrideItemCommands}]}]}]}]}]})};return(0,a.jsx)("div",{className:`w-100 mt-2 ${n||""}`},(0,a.jsx)(L.List,Object.assign({className:"w-100",itemsJson:Array.from(i).map(((e,t)=>{var n;return{itemStateDetailContent:e,itemKey:`${t}`,itemStateTitle:null==e?void 0:e.label,itemStateIcon:{icon:null===(n=e.icon)||void 0===n?void 0:n.svg},itemStateCommands:[{label:o("close"),iconProps:()=>({icon:$,size:12}),action:()=>{(e=>{const t=null==i?void 0:i.asMutable({deep:!0});null==t||t.splice(e,1);const o=r.setIn(["datasourceConfig"],t);v(o),g()})(t)}}]}})),dndEnabled:!0,renderOverrideItemDetailToggle:(t,n)=>{var i;const{itemJsons:r}=n.props,[c]=r,u=null==c?void 0:c.itemStateDetailContent,d=(null==u?void 0:u.searchServiceType)===e.GeocodeService;return((e,t=!1)=>{let o;if(t){const t=(null==S?void 0:S.outputDataSources)||[];o=(null==t?void 0:t.filter((t=>e===t)).length)>0}else o=(null==s?void 0:s.filter((t=>e===t.dataSourceId)).length)>0;return o&&e})(d?null==u?void 0:u.outputDataSourceId:null===(i=null==u?void 0:u.useDataSource)||void 0===i?void 0:i.dataSourceId,d)?"":(0,a.jsx)(l.Alert,{buttonType:"tertiary",form:"tooltip",size:"small",type:"error",text:o("dataSourceCreateError")})},onUpdateItem:(e,t)=>{const{itemJsons:o}=t.props,[,n]=o,a=n.map((e=>e.itemStateDetailContent)),l=r.setIn(["datasourceConfig"],a);m(null),v(l)},onClickItemBody:(t,o)=>{var n;const{itemJsons:[a]}=o.props,l=(null===(n=null==a?void 0:a.itemStateDetailContent)||void 0===n?void 0:n.searchServiceType)===e.GeocodeService;m(+a.itemKey,l)}},h)),d&&(0,a.jsx)(L.List,Object.assign({className:"setting-ui-unit-list-new",itemsJson:[{name:"......"}].map(((e,t)=>({itemStateDetailContent:"item",itemKey:"index",itemStateTitle:"......",itemStateCommands:[]}))),dndEnabled:!1,renderOverrideItemDetailToggle:()=>""},h,{isItemFocused:()=>!0})))},{useSelector:W}=a.ReactRedux,{useRef:V,useEffect:q}=a.React,K=t=>{var o,n,r,c,u,d;const v=l.hooks.useTranslate(m,l.defaultMessages,a.defaultMessages),g=W((e=>null==e?void 0:e.theme)),{config:S,id:h,useDataSources:f,onSettingChange:x}=t,y=V(null),[w,b]=a.React.useState(!1),[I,j]=a.React.useState(!1),[D,R]=a.React.useState(!1),[O,N]=a.React.useState(!1),[L,A]=a.React.useState(null),k=W((e=>{var t,o,n;return null===(n=null===(o=null===(t=null==e?void 0:e.appStateInBuilder)||void 0===t?void 0:t.appConfig)||void 0===o?void 0:o.widgets)||void 0===n?void 0:n[h]})),P=a.css`
    & {
      background-color: ${null===(r=null===(n=null===(o=g.colors)||void 0===o?void 0:o.palette)||void 0===n?void 0:n.secondary)||void 0===r?void 0:r[400]};
    }
  `,F=a.css`
    .data-remind {
      color: ${null===(d=null===(u=null===(c=g.colors)||void 0===c?void 0:c.palette)||void 0===u?void 0:u.dark)||void 0===d?void 0:d[500]};
      font-size: ${a.polished.rem(12)};
    }
  `;q((()=>{z()}),[S]);const z=()=>{const t=(null==k?void 0:k.outputDataSources)||[],o=(null==S?void 0:S.datasourceConfig)||[];for(const n in o){const a=o[n];if((null==a?void 0:a.searchServiceType)===e.FeatureService)continue;const l=null==a?void 0:a.outputDataSourceId;if(!(null==t?void 0:t.includes(l))){U(S);break}}},E=()=>{R(!1),j(!1),A(null)},H=e=>{var t;const o=e?!D:!I;if(N(o),o){const e=(null===(t=null==S?void 0:S.datasourceConfig)||void 0===t?void 0:t.length)||0;A(e)}e?j(o):R(o)},U=e=>{K(e)&&N(!1);const t=B(null==e?void 0:e.datasourceConfig);$(t),x({id:h,config:e},t.outputDataSources)},B=e=>{var t;return null===(t=null==e?void 0:e.asMutable({deep:!0}))||void 0===t?void 0:t.reduce(((e,t)=>{const o=null==t?void 0:t.useDataSource;o&&!T(o,null==e?void 0:e.useDataSources)&&(null==e||e.useDataSources.push(o));const n=J(t);return n&&e.outputDataSources.push(n),e}),{useDataSources:[],outputDataSources:[]})},J=t=>{let o;return(null==t?void 0:t.searchServiceType)===e.GeocodeService&&(o={id:null==t?void 0:t.outputDataSourceId,type:a.DataSourceTypes.FeatureLayer,label:null==t?void 0:t.label,originDataSources:[],isOutputFromWidget:!0,isDataInDataSourceInstance:!1,schema:C(null==t?void 0:t.label),geometryType:"esriGeometryPoint"}),o},$=e=>{var t;const o={id:h},n=(0,i.getAppConfigAction)();o.useDataSources=null==e?void 0:e.useDataSources,o.outputDataSources=null===(t=null==e?void 0:e.outputDataSources)||void 0===t?void 0:t.map((e=>null==e?void 0:e.id)),((e,t,o)=>{var n,a,l,i;const s=(null===(n=null==e?void 0:e.useDataSources)||void 0===n?void 0:n.asMutable({deep:!0}))||[],r=(null===(a=null==e?void 0:e.outputDataSources)||void 0===a?void 0:a.asMutable({deep:!0}))||[];if((null==s?void 0:s.length)!==(null==t?void 0:t.length)||(null==r?void 0:r.length)!==(null==o?void 0:o.length))return!0;const c=(null===(l=null==t?void 0:t.filter((e=>!T(e,s))))||void 0===l?void 0:l.length)>0,u=(null===(i=r.filter((e=>!(null==o?void 0:o.includes(e)))))||void 0===i?void 0:i.length)>0;return c||u})(k,o.useDataSources,o.outputDataSources)&&n.editWidget(o).exec()},K=e=>{var t,o;return(null===(t=null==e?void 0:e.datasourceConfig)||void 0===t?void 0:t.length)!==(null===(o=null==S?void 0:S.datasourceConfig)||void 0===o?void 0:o.length)};return(0,a.jsx)(s.SettingSection,{css:F},(0,a.jsx)(s.SettingRow,{flow:"wrap"},(0,a.jsx)("span",{className:"w-100 data-remind"},v("addSources"))),(0,a.jsx)(s.SettingRow,{flow:"wrap"},(0,a.jsx)(l.Dropdown,{className:"w-100",size:"sm",toggle:()=>{b(!w)},isOpen:w,autoWidth:!0},(0,a.jsx)(l.DropdownButton,{arrow:!1,icon:!0,type:"primary"},(0,a.jsx)(p,{className:"mr-1 d-inline-block",autoFlip:!0}),v("newSearchSource")),(0,a.jsx)(l.DropdownMenu,{css:P},(0,a.jsx)(l.DropdownItem,{className:"w-100",onClick:()=>{H(!0)}},v("layerSource")),(0,a.jsx)(l.DropdownItem,{className:"w-100",onClick:()=>{H(!1)}},v("locatorSource")))),(0,a.jsx)("div",{className:"w-100",ref:y},(0,a.jsx)(G,{id:h,dsConfigItemIndex:L,datasourceConfig:(null==S?void 0:S.datasourceConfig)||(0,a.Immutable)([]),config:S,showSourcePanel:(()=>{var t,o;return(null===(o=null===(t=null==S?void 0:S.datasourceConfig)||void 0===t?void 0:t[L])||void 0===o?void 0:o.searchServiceType)===e.GeocodeService?D:I})(),useDataSources:f,onDsConfigIdChange:(e,t)=>{"number"==typeof e?L===e?t?(R(!D),j(!1)):(j(!I),R(!1)):(A(e),t?(R(!0),j(!1)):(j(!0),R(!1))):E()},showNewSourceItem:O,updateConfigForLayerOptions:U,hideSidePopper:E})),(0,a.jsx)(M,{id:h,dsConfigItemIndex:L,useDataSources:f,isOpen:I,config:S,onSettingChange:x,trigger:null==y?void 0:y.current,updateConfigForLayerOptions:U,toggle:()=>{j(!I),N(!1)}}),(0,a.jsx)(_,{id:h,dsConfigItemIndex:L,useDataSources:f,isOpen:D,onSettingChange:x,updateConfigForLayerOptions:U,config:S,trigger:null==y?void 0:y.current,toggle:()=>{R(!D),N(!1)}})))};var Q=u(24786),X=u.n(Q);const Y=e=>{const{className:t}=e,o=function(e,t){var o={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(o[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(n=Object.getOwnPropertySymbols(e);a<n.length;a++)t.indexOf(n[a])<0&&Object.prototype.propertyIsEnumerable.call(e,n[a])&&(o[n[a]]=e[n[a]])}return o}(e,["className"]),n=(0,a.classNames)("jimu-icon-component",t);return a.React.createElement(l.Icon,Object.assign({className:n,icon:X()},o))},{useSelector:Z}=a.ReactRedux,ee=e=>{const o=l.hooks.useTranslate(m,l.defaultMessages,a.defaultMessages),n=Z((e=>null==e?void 0:e.theme)),i=a.css`
    .check-box-label {
      color: ${n.colors.palette.dark[800]}
    }
    .search-setting-con {
      padding-left: 0;
      padding-right: 0;
    }
    .divider-line {
      padding-bottom: 0;
    }
    .checkbox-con .jimu-widget-setting--row-label{
      max-width: 100%;
    }
  `,r=a.React.useRef(null),{config:c,id:u,useDataSources:d,onSettingChange:p}=e,{searchResultView:v,hint:g,maxSuggestions:S,isUseCurrentLoation:h,isShowRecentSearches:f,recentSearchesMaxNumber:x,resultMaxNumber:y,linkParam:w,isAutoSelectFirstResult:b}=c,[I,j]=a.React.useState(!1),[C,T]=a.React.useState(!1),[D,R]=a.React.useState(!1),[O,N]=a.React.useState(g),[L,A]=a.React.useState(x),[k,P]=a.React.useState(S),[M,F]=a.React.useState(y),z=(e,t)=>{p({id:u,config:c.setIn(e,t)})},E=e=>0===(null==e?void 0:e.length)||Number(e)&&Number(e)>0;return(0,a.jsx)(s.SettingSection,{title:o("generalSearchOption"),css:i},(0,a.jsx)(s.SettingRow,{flow:"wrap",label:o("multySearchHint")},(0,a.jsx)(l.TextInput,{size:"sm",value:O||"",onChange:e=>{var t;const o=null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value;N(o)},onAcceptValue:e=>{e?(N(null==e?void 0:e.trim()),z(["hint"],null==e?void 0:e.trim())):N(g)},className:"w-100",placeholder:o("findAddressOrPlace")})),(0,a.jsx)("div",null,(0,a.jsx)(s.SettingSection,{className:"search-setting-con"},(0,a.jsx)(s.SettingRow,null,(0,a.jsx)(s.SettingCollapse,{label:o("searchSuggestion"),isOpen:I,onRequestOpen:()=>j(!0),onRequestClose:()=>j(!1),level:1},(0,a.jsx)(s.SettingRow,{flow:"wrap",className:"mt-2 checkbox-con",label:o("maximumSuggestions")},(0,a.jsx)(l.TextInput,{size:"sm",value:k,onChange:e=>{const t=e.target.value;E(t)&&P(t)},onAcceptValue:e=>{e||P(e=S||6),E(e)&&z(["maxSuggestions"],Number(e))},className:"w-100"})),(0,a.jsx)(s.SettingRow,null,(0,a.jsx)(l.Checkbox,{checked:h,onClick:e=>{const t=e.currentTarget;t&&z(["isUseCurrentLoation"],t.checked)},className:"mr-1","aria-label":o("useCurrentLocation")}),(0,a.jsx)("span",{className:"check-box-label"},o("useCurrentLocation"))),(0,a.jsx)(s.SettingRow,{label:o("recentSearches")},(0,a.jsx)(l.Switch,{checked:f||!1,onChange:e=>{z(["isShowRecentSearches"],!f)}})),f&&(0,a.jsx)(s.SettingRow,{label:o("maximumNumber")},(0,a.jsx)(l.TextInput,{size:"sm",value:L,onChange:e=>{const t=e.target.value;E(t)&&A(t)},onAcceptValue:e=>{e||A(e=x||6),E(e)&&z(["recentSearchesMaxNumber"],Number(e))},style:{width:"50px"}}))))),I&&(0,a.jsx)(s.SettingSection,{className:"divider-line"})),(0,a.jsx)(s.SettingRow,null,(0,a.jsx)(s.SettingCollapse,{label:o("searchResult"),isOpen:C,onRequestOpen:()=>T(!0),onRequestClose:()=>T(!1),level:1},(0,a.jsx)(s.SettingRow,{label:o("resultPanel"),className:"mt-2"},(0,a.jsx)(l.Switch,{checked:v===t.ResultPanel,onChange:e=>{(e=>{const o=e?t.ResultPanel:t.OtherWidgets;z(["searchResultView"],o)})(v===t.OtherWidgets)}})),v===t.ResultPanel&&(0,a.jsx)(s.SettingRow,{flow:"wrap",className:"checkbox-con",label:o("maximumResults")},(0,a.jsx)(l.TextInput,{size:"sm",value:M,onChange:e=>{const t=e.target.value;E(t)&&F(t)},onAcceptValue:e=>{e||F(e=y||6),E(e)&&z(["resultMaxNumber"],Number(e))},className:"w-100"})),v===t.ResultPanel&&(0,a.jsx)(s.SettingRow,null,(0,a.jsx)(l.Checkbox,{checked:b,onClick:e=>{const t=e.currentTarget;t&&z(["isAutoSelectFirstResult"],t.checked)},className:"mr-1","aria-label":o("autoSelect")}),(0,a.jsx)("span",{className:"check-box-label"},o("autoSelect"))),v===t.OtherWidgets&&(0,a.jsx)(s.SettingRow,{className:"d-block",flow:"wrap",label:o("redirectSearchResult")},(0,a.jsx)(l.Button,{className:"w-100 text-dark set-link-btn",type:"primary",onClick:()=>{R(!D)},ref:r},(0,a.jsx)("div",{className:"w-100 px-2 text-truncate"},(0,a.jsx)(Y,{size:16,className:"add-data-icon"}),o("setLink"))),D&&(0,a.jsx)(s.LinkSettingPopup,{showDialog:D,onSettingCancel:()=>{R(!1)},onSettingConfirm:e=>{e&&(z(["linkParam"],e),R(!1))},linkParam:w,useDataSources:d,widgetId:u,trigger:null==r?void 0:r.current,hiddenLinks:(0,a.Immutable)([a.LinkType.Block,a.LinkType.Dialog,a.LinkType.PageTop,a.LinkType.Screen,a.LinkType.View,a.LinkType.WebAddress]),openTypes:(0,a.Immutable)([s.OpenTypes.CurrentWindow])})))))};var te=u(52127);const oe=t=>{const{config:o,id:n,onSettingChange:i,useDataSources:s}=t,r=l.hooks.useTranslate(m);(0,te.useEffect)((()=>{!(null==o?void 0:o.datasourceConfig)&&c()}),[]);const c=()=>{const t=R([]),l=((e,t)=>{const o=y(f),n=N(t,e),l=C(o);return{id:n,type:a.DataSourceTypes.FeatureLayer,label:o,originDataSources:[],isOutputFromWidget:!0,isDataInDataSourceInstance:!1,schema:l,geometryType:"esriGeometryPoint"}})(n,t),s=((t,o,n)=>({configId:t,label:y(f),geocodeURL:f,outputDataSourceId:N(t,o),useDataSource:null,hint:n,searchServiceType:e.GeocodeService}))(t,n,r("findAddressOrPlace"));let c=null==o?void 0:o.setIn(["datasourceConfig"],[s]);c=null==c?void 0:c.setIn(["hint"],r("findAddressOrPlace")),i({id:n,config:c},[l])};return(0,a.jsx)("div",{className:"widget-setting-search jimu-widget-search"},(0,a.jsx)(K,{id:n,useDataSources:s,onSettingChange:i,config:o}),(0,a.jsx)(ee,{id:n,config:o,onSettingChange:i,useDataSources:s}))}})(),d})())}}}));